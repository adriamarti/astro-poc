---
import Layout from '../layouts/Layout.astro';
import { sanity } from '../lib/sanityClient';

type Post = {
  _id: string;
  title: string;
  slug: { current: string };
  mainImage?: { asset: { url: string } };
};

const posts: Post[] = await sanity.fetch(`
  *[_type == "post"]{
    _id,
    title,
    slug,
    mainImage {
      asset -> {
        url
      }
    }
  }
`);
---

<Layout>
  <main class="p-8 max-w-6xl mx-auto">
    <h1 class="text-4xl font-bold mb-8">Ãšltimos posts</h1>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      {posts.map(post => (
        <a href={`/posts/${post.slug.current}`} class="block rounded-xl overflow-hidden shadow-md hover:shadow-lg transition">
          {post.mainImage?.asset?.url && (
            <img
              src={`${post.mainImage.asset.url}?auto=format&fit=max&w=800`}
              width="800"
              height="400"
              alt={post.title}
              loading="lazy"
              class="w-full h-48 object-cover"
            />
          )}
          <div class="p-4 bg-white">
            <h2 class="text-xl font-semibold">{post.title}</h2>
          </div>
        </a>
      ))}
    </div>
  </main>
</Layout>
